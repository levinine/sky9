service: sky9

provider:
  name: aws
  iamRoleStatements:
    - Effect: Allow
      Action:
        - dynamodb:DescribeTable
        - dynamodb:Query
        - dynamodb:Scan
        - dynamodb:GetItem
        - dynamodb:PutItem
        - dynamodb:UpdateItem
        - dynamodb:DeleteItem
      Resource: "*"
    - Effect: Allow
      Action:
        - cloudtrail:LookupEvents
        - organizations:ListAccounts
        - servicecatalog:*
        - budgets:*
        - sts:GetCallerIdentity
        - controltower:*
        - iam:*
        - sso:*
        - sso-directory:*
      Resource: "*"
  runtime: nodejs10.x
  stage: ${opt:stage, "test"}
  region: ${opt:region, "eu-west-1"}
  environment: ${file(./sls-env.yml):${self:provider.stage}}

plugins:
  - serverless-pseudo-parameters
  - serverless-dynamodb-local
  - serverless-offline
  - serverless-step-functions
  - serverless-dashboard

functions:
  - ${file(./serverless-account-create.yml):functions}
  - ${file(./serverless-account-crud.yml):functions}

stepFunctions:
  ${file(./serverless-account-create.yml):stepFunctions}

custom:
  authorizer:
    type: COGNITO_USER_POOLS
    authorizerId: { Ref: ApiGatewayAuthorizer }
  dynamodb:
    stages:
      - local
    start:
      migrate: true
      port: 8000
  serverless-offline:
      port: 4000

resources:
  - ${file(./resources/dynamoDB.yml)}
  - ${file(./resources/cognito.yml)}
